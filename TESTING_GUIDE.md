# 极简版测试指南

## 🎯 测试目标

验证极简版本能否正常工作：
1. 语音识别准确
2. Excel保存成功
3. 没有闪屏和重复识别问题

---

## 📋 测试前准备

### 1. 确认Python 3.12环境

```batch
# Windows: 打开命令提示符
python --version
# 应该显示：Python 3.12.x
```

如果不是3.12，运行：
```batch
setup_python312.bat
```

### 2. 确认依赖已安装

```batch
pip list | findstr onnxruntime
pip list | findstr sounddevice
pip list | findstr faster-whisper
pip list | findstr pypinyin
```

都应该有版本号显示。

---

## 🧪 基础功能测试

### 测试1：单个学生（序号）

**步骤**：
1. 启动程序：`run_app.bat`
2. 选择Excel文件
3. 点击"开始录音"
4. **清晰地说**："一号一百分"
5. **等待2秒**（静音）
6. 观察控制台输出

**预期结果**：
```
正在识别语音...
识别结果: 1号100分
解析: type=sequence, identifier=1, score=100.0
查找序号: 1
已更新: 一号许凯旋100分
```

**GUI应该显示**：
- 识别结果框：`1号100分`
- 状态栏：`成功录入1条，继续监听...`（绿色）
- 播报：听到"一号，许凯旋，一百分"

✅ **通过标准**：
- Excel文件中第一个学生的分数更新为100
- 无错误信息
- 播报正确

---

### 测试2：单个学生（姓名）

**步骤**：
1. 确保程序还在监听
2. **清晰地说**："张三九十五分"
3. **等待2秒**

**预期结果**：
```
识别结果: 张三95分
解析: type=name, identifier=张三, score=95.0
查找姓名: 张三
拼音模糊匹配: '张三' -> '张三' (相似度: 1.00)
已更新: X号张三95分
```

✅ **通过标准**：
- 找到姓名为"张三"的学生
- 分数更新为95
- 播报正确

---

### 测试3：连续录入

**步骤**：
1. 说"一号一百分"
2. 等待2秒（识别完成后自动进入下一次录音）
3. 说"二号九十五分"
4. 等待2秒
5. 说"三号九十二分"
6. 等待2秒

**预期结果**：
- 三个学生都正确识别
- Excel文件保存3次
- 无"系统运行中"闪屏
- 无重复识别

✅ **通过标准**：
- 控制台输出清晰，无重复
- Excel正确更新3个学生
- GUI状态正常

---

## 🐛 问题诊断

### 问题1：识别不到任何内容

**控制台输出**：
```
录音太短（0.3秒），忽略
```

**原因**：说话太快或VAD没检测到

**解决**：
1. 说话更响亮
2. 调整麦克风音量
3. 如果还不行，编辑 `speech_recognition.py:97`
   ```python
   threshold = 0.02  # 改为 0.015（更灵敏）
   ```

---

### 问题2：只识别到部分（如"100分"）

**控制台输出**：
```
识别结果: 100分
解析失败，识别文本: 100分
```

**原因**：没说"号"字，或者说得太快

**解决**：
1. 必须说"X号XX分"格式
2. 说话要连贯：**"一号一百分"**（不要停顿）
3. 不要说成："一号，一百分"

---

### 问题3：识别成错误的数字

**控制台输出**：
```
识别结果: 2号100分
```
但你说的是"一号"

**原因**：Whisper识别错误

**解决**：
1. 说话更清晰
2. 尝试说阿拉伯数字："1号100分"（而不是"一号"）
3. 检查prompt是否合适（`speech_recognition.py:195`）

---

### 问题4：Excel保存失败

**错误信息**：
```
保存失败，文件可能被占用
```

**解决**：
1. 关闭Excel程序
2. 检查文件是否被其他程序占用
3. 确认文件路径有写权限

---

### 问题5：后台一直闪"系统运行中"

**如果还出现这个问题**：

**检查**：
1. 确认使用的是最新代码（刚刚提交的极简版）
2. 重启程序
3. 检查是否有多个Python进程在运行：
   ```batch
   tasklist | findstr python
   ```
4. 如果有多个，全部关闭后重启

---

## 📊 性能基准

### 正常指标

| 指标 | 预期值 |
|------|--------|
| 录音时长 | 2-3秒 |
| 识别耗时 | 1-2秒 |
| 总耗时 | 3-5秒/次 |
| 准确率 | >90% |

### 如何测量

在控制台看时间戳：
```
[2025-01-13 20:30:01] 正在识别语音...
[2025-01-13 20:30:03] 识别结果: 1号100分
```

---

## ✅ 测试清单

- [ ] 测试1：单个序号识别
- [ ] 测试2：单个姓名识别
- [ ] 测试3：连续录入3个
- [ ] 测试4：Excel文件正确更新
- [ ] 测试5：语音播报正确
- [ ] 测试6：无闪屏问题
- [ ] 测试7：无重复识别

---

## 📝 反馈模板

如果遇到问题，请提供：

```
## 测试环境
- Python版本：
- 操作系统：
- 麦克风：

## 复现步骤
1.
2.
3.

## 实际结果
（粘贴控制台输出）

## 预期结果


## 其他信息

```

---

**重要**：如果基础测试通过，说明系统运行正常。如果失败，请根据问题诊断部分排查。
