# 登分助手

一个离线本地化的图形界面应用，支持语音输入识别和语音播报，用于自动填写Excel成绩表。

## 功能特点

- ✅ 图形化界面，操作简单
- ✅ **GUI配置界面**：可在界面中调整模型、录音、语音等参数
- ✅ **实时语音识别**：说完自动识别，无需点击停止
- ✅ **智能识别优化**：使用引导性 prompt 提高识别准确率
- ✅ **VAD 降噪**：自动过滤环境噪音，提升识别质量
- ✅ **多模型支持**：可选择tiny/small/base/medium/large模型
- ✅ 支持语音输入识别（中文）
- ✅ 支持序号或姓名定位学生
- ✅ 自动更新Excel成绩
- ✅ 语音播报确认（支持多种语音和语速调整）
- ✅ **配置持久化**：设置自动保存，下次启动自动加载
- ✅ 完全离线运行，无需网络
- ✅ 支持.xls和.xlsx格式

## 系统要求

- Windows 10/11
- Python 3.12+（建议使用 Python 3.12.10 或更高版本）
- 麦克风设备（用于语音输入）
- 至少2GB可用磁盘空间（用于模型文件）

## 安装步骤

### 方式一：使用exe文件（推荐）

1. 下载 `登分助手.exe` 文件
2. 双击运行即可
3. 首次运行会自动下载语音识别模型（需要网络连接，仅首次）

### 方式二：从源码运行

1. 克隆或下载项目文件
2. 安装Python依赖：
```bash
pip install -r requirements.txt
```

3. （推荐）安装 onnxruntime 以启用 VAD 降噪功能：
```bash
pip install onnxruntime
```

4. 运行程序：
```bash
python main.py
```

## 使用方法

### 主界面操作

1. **选择Excel文件**
   - 点击"选择Excel文件"按钮
   - 选择包含学生信息的Excel文件
   - Excel格式要求：
     - A列：学号
     - B列：姓名
     - E列：平时成绩
     - H列：期末成绩

2. **选择输入列**
   - 选择"期末成绩"或"平时成绩"
   - 后续语音输入将更新对应列

3. **语音输入（实时识别）**
   - 点击"开始录音"按钮
   - **直接说话**：`"张三，100分"` 或 `"1号，100分"`
   - **说完后自动识别**（检测到静音后自动处理）
   - 程序会自动更新Excel并语音播报确认
   - 可以连续说多个，无需重复点击按钮
   - 点击"停止录音"结束监听

4. **语音输入格式**
   - 姓名模式：`"张三，100分"`、`"李四，95分"`
   - 序号模式：`"1号，100分"`、`"第2号，95分"`
   - 注意：序号是指Excel表格中的数据行序号（跳过表头，从1开始计数）

### 设置界面

点击"设置"标签页可以配置：

1. **语音识别模型配置**
   - **模型版本**：
     - tiny: 最快，约39MB，适合配置较低的电脑
     - small: 较快，约244MB，准确度一般
     - base: 平衡，约147MB，速度和准确度平衡
     - medium: 推荐，约1.5GB，准确度高（默认）
     - large: 最准确，约3GB，速度较慢
   - **计算设备**：cpu（推荐）或cuda（需要NVIDIA显卡）
   - **计算精度**：int8（速度快内存少）、float16、float32（精度高但慢）

2. **录音配置**
   - **最大录音时长**：单次录音的最长时间（1-10秒）
   - **静音检测时长**：静音多久后认为说话结束（0.5-3秒）
   - **最小说话时长**：低于此时长的录音将被忽略（0.1-2秒）

3. **语音合成配置**
   - **语音选择**：可选择不同的中文语音（男声/女声）
   - **语速调整**：调整播报语速（-50%到+50%）

4. **配置操作**
   - **保存配置**：保存当前设置到本地文件
   - **重置为默认**：恢复所有设置为默认值
   - **应用并重新加载模型**：更改模型配置后需要点击此按钮才能生效

**注意**：
- 配置会自动保存到用户目录的 `.score_helper_config.json` 文件
- 下次启动程序会自动加载上次的配置
- 更改模型配置后，需要点击"应用并重新加载模型"才能生效
- 重新加载模型可能需要几分钟时间

## 打包为exe

如果需要自己打包：

```bash
python build_exe.py
```

打包后的exe文件位于 `dist/登分助手.exe`

## 注意事项

1. **Excel文件格式**
   - 确保Excel文件格式正确
   - 第一行可以是表头（包含"学号"、"姓名"等字样）
   - 如果第一行是表头，程序会自动识别

2. **文件占用**
   - 更新成绩时，请确保Excel文件未被其他程序打开
   - 如果保存失败，请关闭Excel文件后重试

3. **语音识别**
   - 确保环境安静，麦克风正常工作
   - 说话清晰，语速适中
   - 如果识别失败，可以重试

4. **模型文件**
   - 首次运行需要下载模型（约150MB）
   - 模型会缓存在用户目录，后续运行无需下载
   - 确保有足够的磁盘空间

## 故障排除

### 问题：无法录音
- 检查麦克风是否已连接
- 检查系统麦克风权限设置
- 尝试重启程序

### 问题：识别失败
- 检查环境是否安静
- 说话清晰，语速适中
- 确保说话内容符合格式要求

### 问题：找不到学生
- 检查Excel文件中是否有该学生
- 检查序号或姓名是否正确
- 序号是从1开始的数据行序号（不包含表头）
- 尝试使用另一种定位方式（序号/姓名）

### 问题：保存失败
- 确保Excel文件未被其他程序打开
- 检查文件是否只读
- 检查磁盘空间是否充足

## 技术栈

- Python 3.12+
- tkinter（GUI）
- faster-whisper（语音识别，支持 initial_prompt 引导识别）
- sounddevice（实时录音）
- edge-tts（语音合成）
- openpyxl（Excel处理）
- pandas（数据处理）
- onnxruntime（可选，启用 VAD 降噪功能）

## 许可证

本项目仅供个人使用。

## 更新日志

### v1.3.0
- **新增GUI配置界面**：可在界面中调整模型、录音、语音合成等参数
- **配置持久化**：设置自动保存到本地，下次启动自动加载
- **多模型支持**：可选择tiny/small/base/medium/large模型
- **语音合成配置**：支持多种中文语音和语速调整
- **录音参数可调**：可调整静音检测时长、最小说话时长等参数
- 优化界面布局，使用标签页分离主界面和设置界面

### v1.2.0
- 新增智能识别优化：使用 initial_prompt 引导 whisper 优先识别"序号+分数"和"姓名+分数"格式
- 启用 VAD 降噪功能，自动过滤环境噪音
- 将学号识别改为序号识别，简化输入流程

### v1.1.0
- 降级到 Python 3.12.10，提高兼容性
- 修复 Windows 系统 GBK 编码错误

### v1.0.0
- 初始版本
- 支持语音输入识别
- 支持Excel成绩更新
- 支持语音播报确认
